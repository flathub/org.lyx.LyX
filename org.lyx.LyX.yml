app-id: org.lyx.LyX
runtime: org.kde.Platform
runtime-version: '6.9'
sdk: org.kde.Sdk
command: lyx
rename-desktop-file: lyx.desktop
rename-icon: lyx
finish-args:
  - --socket=wayland
  - --socket=fallback-x11
  - --device=dri
  - --share=ipc
  - --persist=.lyx
  - --filesystem=home
  - --env=PATH=/usr/bin:/app/bin:/app/plugins/maxima/bin
sdk-extensions:
  - org.freedesktop.Sdk.Extension.texlive
add-extensions:
  org.freedesktop.Sdk.Extension.texlive:
    version: '24.08'
    directory: texlive
    autodelete: false
  org.lyx.LyX.Plugin:
    versions: stable;beta;test
    directory: plugins
    subdirectories: true
    no-autodownload: true
    autodelete: true
    add-ld-path: lib
  io.github.wxmaxima_developers.wxMaxima.Plugin.maxima:
    versions: stable;test;master
    directory: plugins/maxima
    subdirectories: false
    no-autodownload: true
    autodelete: true
    add-ld-path: lib

modules:
  - name: texliveYextensions
    buildsystem: simple
    build-commands:
      - install -d /app/texlive
      - install -d /app/plugins

  - name: ghostscript
    config-opts:
      - --disable-cups
    build-options:
      ldflags: -L/app/lib
      arch:
        aarch64:
          cppflags: -DPNG_ARM_NEON_OPT=0
    sources:
      - type: archive
        url: https://github.com/ArtifexSoftware/ghostpdl-downloads/releases/download/gs10051/ghostscript-10.05.1.tar.gz
        sha512: ac1ab58f474467006d7735858e42a3db9a07aa092f907b14f1147447d08c8b4f5b499bca31c09c1558304787fe59d666c9f1aa531d219f27e17d5f9c9523f58c
        x-checker-data:
          type: json
          url: https://api.github.com/repos/ArtifexSoftware/ghostpdl-downloads/releases/latest
          version-query: .name | split(" ") | .[1]
          url-query: .assets[] | select(.name|test("^ghostscript-(.*).tar.gz$")) |
            .browser_download_url
  - name: ImageMagick
    sources:
      - type: git
        url: https://github.com/ImageMagick/ImageMagick.git
        tag: 7.1.1-47
        commit: 82572afc879b439cbf8c9c6f3a9ac7626adf98fb
        x-checker-data:
          type: git
          tag-pattern: ^([\d.]+-[\d]+)$
  - name: ed-rcs
    sources:
      - type: archive
        url: https://ftp.gnu.org/gnu/ed/ed-1.21.1.tar.lz
        sha256: d6d0c7192b02b0519c902a93719053e865ade5a784a3b327d93d888457b23c4b
        x-checker-data:
          type: anitya
          project-id: 659
          url-template: https://ftp.gnu.org/gnu/ed/ed-$version.tar.lz
  - name: rcs
    sources:
      - type: archive
        url: https://ftp.gnu.org/gnu/rcs/rcs-5.10.1.tar.lz
        sha256: 43ddfe10724a8b85e2468f6403b6000737186f01e60e0bd62fde69d842234cc5
        x-checker-data:
          type: anitya
          project-id: 4167
          url-template: https://ftp.gnu.org/gnu/rcs/rcs-$version.tar.lz
  - name: fonts
    buildsystem: simple
    build-commands:
      - mkdir /app/share/fonts
      - cp static/OTF/* /app/share/fonts/
      - chmod +x search-configure-TEXfonts.sh && ./search-configure-TEXfonts.sh
    sources:
      - type: file
        path: search-configure-TEXfonts.sh
      - type: archive #libertinus
        url: https://github.com/alerque/libertinus/releases/download/v7.051/Libertinus-7.051.tar.zst
        sha256: 250677c929d3775a30913643594379af264ac2ef2801035aa1dcbe30b9be23a6
        x-checker-data:
          type: json
          url: https://api.github.com/repos/alerque/libertinus/releases/latest
          version-query: .name | split(" ") | .[1]
          url-query: .assets[] | select(.name|test("^Libertinus-(.*).tar.zst$")) |
            .browser_download_url
  - name: dictEs-aspell
    buildsystem: simple
    build-commands:
      - ./configure
      - make datadir=/app/share/dicts dictdir=/app/share/dicts
      - make datadir=/app/share/dicts dictdir=/app/share/dicts install
    sources:
      - type: archive
        url: https://ftp.gnu.org/gnu/aspell/dict/es/aspell6-es-1.11-2.tar.bz2
        sha256: ad367fa1e7069c72eb7ae37e4d39c30a44d32a6aa73cedccbd0d06a69018afcc
        x-checker-data:
          type: anitya
          project-id: 16361
          url-template: https://ftp.gnu.org/gnu/aspell/dict/es/aspell6-es-$version.tar.bz2
  - name: dictEn-aspell
    buildsystem: simple
    build-commands:
      - ./configure
      - make datadir=/app/share/dicts dictdir=/app/share/dicts
      - make datadir=/app/share/dicts dictdir=/app/share/dicts install
    sources:
      - type: archive
        url: https://ftp.gnu.org/gnu/aspell/dict/en/aspell6-en-2020.12.07-0.tar.bz2
        sha256: 4c8f734a28a088b88bb6481fcf972d0b2c3dc8da944f7673283ce487eac49fb3
        x-checker-data:
          type: anitya
          project-id: 7838
          url-template: https://ftp.gnu.org/gnu/aspell/dict/en/aspell6-en-$version.tar.bz2
  - name: lyx
    config-opts:
      - --with-included-hunspell
      - --enable-qt6
    post-install:
      - rm -r /app/share/metainfo
      - install -Dm644 org.lyx.LyX.appdata.xml /app/share/appdata/org.lyx.LyX.appdata.xml
      - install -Dm755 evince /app/bin/evince
      - mv /app/bin/lyx /app/bin/_lyx
      - install -Dm755 lyx -t /app/bin/
    sources:
      - type: archive
        url: https://ftp.lip6.fr/pub/lyx/stable/2.4.x/lyx-2.4.4.tar.xz
        sha256: ffacd37480f320f3f3f8f30445fe40897e9df44c94ee87ba0413e364086f4b90
        x-checker-data:
          type: anitya
          project-id: 1864
          url-template: https://ftp.lip6.fr/pub/lyx/stable/$major.$minor.x/lyx-$version.tar.xz
      - type: file
        path: lyx
      - type: file
        path: evince
      - type: file
        path: org.lyx.LyX.appdata.xml

